@page "{id:int}"
@model ProductDetailModel
@{
    ViewData["Title"] = Model.Product?.Name ?? "Ürün Detayı";
    ViewData["Description"] = Model.Product?.ShortDescription ?? "Ürün detayları";
    ViewData["Keywords"] = $"{Model.Product?.Name}, {Model.Product?.Category?.Name}, online alışveriş";
}

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="bg-light py-3">
    <div class="container">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Ana Sayfa</a></li>
            <li class="breadcrumb-item"><a href="/categories" class="text-decoration-none">Kategoriler</a></li>
            @if (Model.Product?.Category != null)
            {
                <li class="breadcrumb-item"><a href="/category/@Model.Product.Category.Slug" class="text-decoration-none">@Model.Product.Category.Name</a></li>
            }
            <li class="breadcrumb-item active" aria-current="page">@Model.Product?.Name</li>
        </ol>
    </div>
</nav>

<!-- Product Detail Section -->
<section class="product-detail py-5">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
            <div class="col-lg-6 mb-4">
                <div class="product-images">
                    <!-- Main Image -->
                    <div class="main-image mb-3">
                        <img src="@(Model.Product?.Images?.FirstOrDefault()?.ImageUrl ?? "https://via.placeholder.com/600x600")" 
                             alt="@Model.Product?.Name" 
                             class="img-fluid rounded" 
                             id="mainProductImage">
                    </div>
                    
                    <!-- Thumbnail Images -->
                    @if (Model.Product?.Images?.Any() == true)
                    {
                        <div class="thumbnail-images">
                            <div class="row g-2">
                                @foreach (var image in Model.Product.Images.Take(4))
                                {
                                    <div class="col-3">
                                        <img src="@image.ImageUrl" 
                                             alt="@Model.Product.Name" 
                                             class="img-fluid rounded thumbnail-img" 
                                             onclick="changeMainImage(this.src)"
                                             style="cursor: pointer; border: 2px solid transparent;">
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <!-- Product Info -->
            <div class="col-lg-6">
                <div class="product-info">
                    <!-- Product Title -->
                    <h1 class="product-title mb-3">@Model.Product?.Name</h1>
                    
                    <!-- Product Rating -->
                    <div class="product-rating mb-3">
                        <div class="stars">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= (Model.Product?.Rating ?? 0))
                                {
                                    <i class="fas fa-star text-warning"></i>
                                }
                                else
                                {
                                    <i class="far fa-star text-warning"></i>
                                }
                            }
                        </div>
                        <span class="rating-text ms-2">@(Model.Product?.Rating ?? 0)/5</span>
                        <span class="review-count ms-2">(@(Model.Product?.ReviewCount ?? 0) değerlendirme)</span>
                    </div>
                    
                    <!-- Product Price -->
                    <div class="product-price mb-4">
                        @if (Model.Product?.CompareAtPrice > Model.Product?.Price)
                        {
                            <span class="current-price fs-2 fw-bold text-primary">₺@Model.Product.Price.ToString("N2")</span>
                            <span class="compare-price fs-5 text-muted text-decoration-line-through ms-3">₺@Model.Product.CompareAtPrice?.ToString("N2")</span>
                            
                                var discountPercentage = Model.Product.CompareAtPrice.HasValue ? 
                                    ((Model.Product.CompareAtPrice.Value - Model.Product.Price) / Model.Product.CompareAtPrice.Value * 100).ToString("N0") : "0";
                           
                            <span class="discount-badge badge bg-danger ms-2">%@discountPercentage İndirim</span>
                        }
                        else
                        {
                            <span class="current-price fs-2 fw-bold text-primary">₺@Model.Product?.Price.ToString("N2")</span>
                        }
                    </div>
                    
                    <!-- Product Description -->
                    <div class="product-description mb-4">
                        <h6>Ürün Açıklaması</h6>
                        <p class="text-muted">@Model.Product?.Description</p>
                    </div>
                    
                    <!-- Product Variants -->
                    @if (Model.Product?.Variants?.Any() == true)
                    {
                        <div class="product-variants mb-4">
                            <h6>Varyantlar</h6>
                            <div class="variant-options">
                                @foreach (var variant in Model.Product.Variants)
                                {
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="variant" id="variant@variant.Id" value="@variant.Id">
                                        <label class="form-check-label" for="variant@variant.Id">
                                            @variant.VariantName
                                        </label>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                    
                    <!-- Quantity and Add to Cart -->
                    <div class="add-to-cart-section mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <label class="form-label">Adet:</label>
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary" type="button" onclick="decreaseQuantity()">-</button>
                                    <input type="number" class="form-control text-center" id="quantity" value="1" min="1" max="@(Model.Product?.StockQty ?? 999)">
                                    <button class="btn btn-outline-secondary" type="button" onclick="increaseQuantity()">+</button>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="stock-info">
                                    <small class="text-muted">
                                        @if (Model.Product?.StockQty > 0)
                                        {
                                            <span class="text-success">✓ Stokta @Model.Product.StockQty adet</span>
                                        }
                                        else
                                        {
                                            <span class="text-danger">✗ Stokta yok</span>
                                        }
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="action-buttons mb-4">
                        <div class="row g-2">
                            <div class="col-md-8">
                                <button class="btn btn-primary btn-lg w-100" onclick="addToCart()">
                                    <i class="fas fa-shopping-cart me-2"></i>Sepete Ekle
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-outline-danger btn-lg w-100" onclick="addToWishlist()">
                                    <i class="fas fa-heart me-2"></i>Favori
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Product Features -->
                    <div class="product-features mb-4">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="feature-item text-center p-3 bg-light rounded">
                                    <i class="fas fa-truck text-primary mb-2"></i>
                                    <div><small>Ücretsiz Kargo</small></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="feature-item text-center p-3 bg-light rounded">
                                    <i class="fas fa-undo text-primary mb-2"></i>
                                    <div><small>14 Gün İade</small></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Details Tabs -->
<section class="product-tabs py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs" id="productTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                            <i class="fas fa-info-circle me-2"></i>Detaylar
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
                            <i class="fas fa-cogs me-2"></i>Özellikler
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                            <i class="fas fa-star me-2"></i>Değerlendirmeler
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping" type="button" role="tab">
                            <i class="fas fa-shipping-fast me-2"></i>Kargo
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="productTabsContent">
                    <!-- Description Tab -->
                    <div class="tab-pane fade show active" id="description" role="tabpanel">
                        <div class="p-4 bg-white">
                            <h5>Ürün Detayları</h5>
                            <p>@Model.Product?.Description</p>
                            @if (!string.IsNullOrEmpty(Model.Product?.ShortDescription))
                            {
                                <h6>Kısa Açıklama</h6>
                                <p>@Model.Product.ShortDescription</p>
                            }
                        </div>
                    </div>
                    
                    <!-- Specifications Tab -->
                    <div class="tab-pane fade" id="specifications" role="tabpanel">
                        <div class="p-4 bg-white">
                            <h5>Teknik Özellikler</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td><strong>Kategori:</strong></td>
                                                <td>@Model.Product?.Category?.Name</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Marka:</strong></td>
                                                <td>@Model.Product?.Brand</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Model:</strong></td>
                                                <td>@Model.Product?.Model</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Ağırlık:</strong></td>
                                                <td>@Model.Product?.Weight kg</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td><strong>SKU:</strong></td>
                                                <td>@Model.Product?.Sku</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Barkod:</strong></td>
                                                <td>@Model.Product?.Barcode</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Garanti:</strong></td>
                                                <td>2 Yıl</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Menşei:</strong></td>
                                                <td>Türkiye</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reviews Tab -->
                    <div class="tab-pane fade" id="reviews" role="tabpanel">
                        <div class="p-4 bg-white">
                            <h5>Müşteri Değerlendirmeleri</h5>
                            <div class="reviews-summary mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-3 text-center">
                                        <div class="overall-rating">
                                            <h2 class="text-primary mb-0">@(Model.Product?.Rating?.ToString("N1") ?? "0.0")</h2>
                                            <div class="stars mb-2">
                                                @for (int i = 1; i <= 5; i++)
                                                {
                                                    if (i <= (Model.Product?.Rating ?? 0))
                                                    {
                                                        <i class="fas fa-star text-warning"></i>
                                                    }
                                                    else
                                                    {
                                                        <i class="far fa-star text-warning"></i>
                                                    }
                                                }
                                            </div>
                                            <small class="text-muted">@(Model.Product?.ReviewCount ?? 0) değerlendirme</small>
                                        </div>
                                    </div>
                                    <div class="col-md-9">
                                        <div class="rating-bars">
                                            @for (int i = 5; i >= 1; i--)
                                            {
                                                var percentage = Model.Product?.ReviewCount > 0 ? (Model.Product.Reviews?.Count(r => r.Rating == i) ?? 0) * 100 / Model.Product.ReviewCount : 0;
                                                <div class="rating-bar-item d-flex align-items-center mb-2">
                                                    <span class="me-2">@i <i class="fas fa-star text-warning"></i></span>
                                                    <div class="progress flex-grow-1 me-2" style="height: 8px;">
                                                        <div class="progress-bar bg-warning" style="width: @percentage%"></div>
                                                    </div>
                                                    <span class="text-muted">@percentage%</span>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Review Form -->
                            <div class="review-form mb-4">
                                <h6>Değerlendirme Yap</h6>
                                <form>
                                    <div class="mb-3">
                                        <label class="form-label">Puanınız:</label>
                                        <div class="rating-input">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <input type="radio" name="rating" id="rating@i" value="@i" class="d-none">
                                                <label for="rating@i" class="rating-star">
                                                    <i class="far fa-star text-warning fs-4"></i>
                                                </label>
                                            }
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Yorumunuz:</label>
                                        <textarea class="form-control" rows="3" placeholder="Ürün hakkında düşüncelerinizi paylaşın..."></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Değerlendirme Gönder</button>
                                </form>
                            </div>
                            
                            <!-- Reviews List -->
                            <div class="reviews-list">
                                @if (Model.Product?.Reviews?.Any() == true)
                                {
                                    foreach (var review in Model.Product.Reviews.Take(5))
                                    {
                                        <div class="review-item border-bottom pb-3 mb-3">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <strong>@review.CustomerName</strong>
                                                    <div class="stars">
                                                        @for (int i = 1; i <= 5; i++)
                                                        {
                                                            if (i <= review.Rating)
                                                            {
                                                                <i class="fas fa-star text-warning"></i>
                                                            }
                                                            else
                                                            {
                                                                <i class="far fa-star text-warning"></i>
                                                            }
                                                        }
                                                    </div>
                                                </div>
                                                <small class="text-muted">@review.CreatedAt.ToString("dd.MM.yyyy")</small>
                                            </div>
                                            <p class="mb-0">@review.Comment</p>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <p class="text-muted">Henüz değerlendirme yapılmamış. İlk değerlendirmeyi siz yapın!</p>
                                }
                            </div>
                        </div>
                    </div>
                    
                    <!-- Shipping Tab -->
                    <div class="tab-pane fade" id="shipping" role="tabpanel">
                        <div class="p-4 bg-white">
                            <h5>Kargo ve Teslimat</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Kargo Bilgileri</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>150₺ üzeri ücretsiz kargo</li>
                                        <li><i class="fas fa-check text-success me-2"></i>1-3 iş günü içinde kargoya verilir</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Kargo takip numarası SMS ile bildirilir</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Kapıda ödeme seçeneği mevcuttur</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Teslimat Süreleri</h6>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-clock text-primary me-2"></i>İstanbul: 1-2 iş günü</li>
                                        <li><i class="fas fa-clock text-primary me-2"></i>Ankara, İzmir: 2-3 iş günü</li>
                                        <li><i class="fas fa-clock text-primary me-2"></i>Diğer şehirler: 3-5 iş günü</li>
                                        <li><i class="fas fa-clock text-primary me-2"></i>Adres bilgileri kontrol edilmelidir</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
<section class="related-products py-5">
    <div class="container">
        <h3 class="mb-4">Benzer Ürünler</h3>
        <div class="row g-4">
            @for (int i = 1; i <= 4; i++)
            {
                <div class="col-lg-3 col-md-6">
                    <div class="product-card bg-white rounded shadow-sm h-100">
                        <div class="product-image position-relative">
                            <img src="https://via.placeholder.com/300x300/6c757d/ffffff?text=Related+@i" alt="Related Product @i" class="img-fluid rounded-top w-100">
                            <div class="product-actions position-absolute top-0 end-0 p-2">
                                <button class="btn btn-sm btn-light rounded-circle mb-1">
                                    <i class="far fa-heart"></i>
                                </button>
                                <button class="btn btn-sm btn-light rounded-circle">
                                    <i class="fas fa-eye text-primary"></i>
                                </button>
                            </div>
                        </div>
                        <div class="product-info p-3">
                            <h6 class="product-title mb-2">Benzer Ürün @i</h6>
                            <div class="product-rating mb-2">
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="far fa-star text-warning"></i>
                                <small class="text-muted ms-1">(45)</small>
                            </div>
                            <div class="product-price mb-3">
                                <span class="fs-5 fw-bold text-primary">₺@(99.99 + i * 10).ToString("N2")</span>
                            </div>
                            <button class="btn btn-primary w-100">
                                <i class="fas fa-shopping-cart me-2"></i>Sepete Ekle
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // Product Image Gallery
        function changeMainImage(src) {
            document.getElementById('mainProductImage').src = src;
            
            // Update active thumbnail
            document.querySelectorAll('.thumbnail-img').forEach(img => {
                img.style.borderColor = 'transparent';
            });
            event.target.style.borderColor = '#0d6efd';
        }
        
        // Quantity Controls
        function decreaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            if (quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
        }
        
        function increaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            const maxStock = @(Model.Product?.StockQty ?? 999);
            if (parseInt(quantityInput.value) < maxStock) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
        }
        
        // Add to Cart
        function addToCart() {
            const quantity = document.getElementById('quantity').value;
            const productId = @(Model.Product?.Id ?? 0);
            
            if (productId > 0) {
                // Add to cart logic here
                showNotification('Ürün sepete eklendi!', 'success');
            }
        }
        
        // Add to Wishlist
        function addToWishlist() {
            const productId = @(Model.Product?.Id ?? 0);
            
            if (productId > 0) {
                // Add to wishlist logic here
                showNotification('Ürün favorilere eklendi!', 'success');
            }
        }
        
        // Rating Input
        document.addEventListener('DOMContentLoaded', function() {
            const ratingStars = document.querySelectorAll('.rating-star');
            
            ratingStars.forEach((star, index) => {
                star.addEventListener('click', function() {
                    // Reset all stars
                    ratingStars.forEach(s => s.querySelector('i').className = 'far fa-star text-warning fs-4');
                    
                    // Fill stars up to clicked one
                    for (let i = 0; i <= index; i++) {
                        ratingStars[i].querySelector('i').className = 'fas fa-star text-warning fs-4';
                    }
                    
                    // Set hidden input value
                    document.querySelector(`#rating${index + 1}`).checked = true;
                });
            });
        });
        
        // Show notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
    </script>
}
