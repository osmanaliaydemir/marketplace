@page
@model Dashboard.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Ürünler";
}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mağaza Başvuruları - Dashboard</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
        }

            .sidebar .nav-link {
                color: rgba(255, 255, 255, 0.8);
                padding: 12px 20px;
                border-radius: 8px;
                margin: 2px 10px;
                transition: all 0.3s ease;
            }

                .sidebar .nav-link:hover,
                .sidebar .nav-link.active {
                    color: white;
                    background: rgba(255, 255, 255, 0.1);
                    transform: translateX(5px);
                }

                .sidebar .nav-link i {
                    width: 20px;
                    margin-right: 10px;
                }

        .main-content {
            background: #f8f9fa;
            min-height: 100vh;
        }

        .table-card {
            background: white;
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .table th {
            background: #f8f9fa;
            border: none;
            font-weight: 600;
            color: #495057;
        }

        .table td {
            vertical-align: middle;
            border-color: #f1f3f4;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d1edff;
            color: #0c5460;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-cancelled {
            background: #e2e3e5;
            color: #383d41;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 8px 20px;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">

            <!-- Main content -->
            <main class="col-md-12 ms-sm-auto col-lg-12 px-md-4 main-content">
                <!-- Top navbar -->
                <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm rounded-3 mt-3">
                    <div class="container-fluid">
                        <button class="navbar-toggler d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target=".sidebar">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <span class="navbar-brand mb-0 h1">
                            <i class="bi bi-file-earmark-text me-2 text-primary"></i>
                           Ürünler
                        </span>

                        <div class="d-flex align-items-center">
                            <div class="user-info me-3">
                                <i class="bi bi-person-circle me-2"></i>
                                Admin User
                            </div>
                            <a href="/Login" class="btn btn-outline-danger btn-sm">
                                <i class="bi bi-box-arrow-right me-1"></i>
                                Çıkış
                            </a>
                        </div>
                    </div>
                </nav>
                <!-- Applications Table -->
                <div class="card table-card">
            
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <h2></h2>
                        <a class="btn btn-primary" asp-page="/Products/New">Yeni Ürün</a>
                    </div>

                    @if (TempData["Success"] is string s)
                    {
                        <div class="alert alert-success">@s</div>
                    }
                    @if (TempData["Error"] is string e)
                    {
                        <div class="alert alert-danger">@e</div>
                    }

                    <form method="get" class="card mb-3">
                        <div class="card-body row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Arama</label>
                                <input class="form-control" name="SearchRequest.SearchTerm" value="@Model.SearchRequest.SearchTerm" placeholder="Ürün adı, açıklama..." />
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Kategori</label>
                                <select class="form-select" name="SearchRequest.CategoryId">
                                    <option value="">Tüm Kategoriler</option>
                                    @foreach (var category in Model.Categories.Where(c => c.ParentId == null).OrderBy(c => c.DisplayOrder))
                                    {
                                        <optgroup label="@category.Name">
                                            <option value="@category.Id" selected="@(Model.SearchRequest.CategoryId == category.Id)">@category.Name</option>
                                            @foreach (var subCategory in Model.Categories.Where(sc => sc.ParentId == category.Id).OrderBy(sc => sc.DisplayOrder))
                                            {
                                                <option value="@subCategory.Id" selected="@(Model.SearchRequest.CategoryId == subCategory.Id)">&nbsp;&nbsp;└ @subCategory.Name</option>
                                            }
                                        </optgroup>
                                    }
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Mağaza ID</label>
                                <input class="form-control" name="SearchRequest.StoreId" value="@Model.SearchRequest.StoreId" placeholder="Mağaza ID" />
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Min Fiyat</label>
                                <input class="form-control" name="SearchRequest.MinPrice" value="@Model.SearchRequest.MinPrice" placeholder="0.00" />
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Max Fiyat</label>
                                <input class="form-control" name="SearchRequest.MaxPrice" value="@Model.SearchRequest.MaxPrice" placeholder="999999.99" />
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button class="btn btn-outline-primary w-100" type="submit">Ara</button>
                            </div>
                        </div>
                    </form>

                    <div class="card">
                        <div class="table-responsive">
                            <table class="table table-striped align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Ürün</th>
                                        <th>Kategori</th>
                                        <th>Mağaza</th>
                                        <th class="text-end">Fiyat</th>
                                        <th class="text-center">Stok</th>
                                        <th class="text-center">Aktif</th>
                                        <th class="text-center">Yayın</th>
                                        <th class="text-center">Öne Çıkan</th>
                                        <th class="text-end"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var p in Model.SearchResponse.Products)
                                    {
                                        <tr>
                                            <td>@p.Id</td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="@p.PrimaryImageUrl" width="40" height="40" class="rounded me-2" onerror="this.style.display='none'" />
                                                    <div>
                                                        <div class="fw-semibold">@p.Name</div>
                                                        <div class="text-muted small">@p.Slug</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>@p.CategoryName</td>
                                            <td>@p.StoreName</td>
                                            <td class="text-end">@p.Price.ToString("N2") @p.Currency</td>
                                            <td class="text-center">@p.StockQty</td>
                                            <td class="text-center">
                                                <form method="post" asp-page-handler="ToggleStatus">
                                                    <input type="hidden" name="id" value="@p.Id" />
                                                    <input type="hidden" name="isActive" value="@(!p.IsActive)" />
                                                    <input type="hidden" name="isPublished" value="@p.IsActive" />
                                                    <input type="hidden" name="isFeatured" value="@p.IsFeatured" />
                                                    <button class="btn btn-sm @(p.IsActive ? "btn-success" : "btn-outline-secondary")" type="submit">@(p.IsActive ? "Aktif" : "Pasif")</button>
                                                </form>
                                            </td>
                                            <td class="text-center">
                                                <form method="post" asp-page-handler="ToggleStatus">
                                                    <input type="hidden" name="id" value="@p.Id" />
                                                    <input type="hidden" name="isActive" value="@p.IsActive" />
                                                    <input type="hidden" name="isPublished" value="@(!p.IsActive || !p.IsFeatured ? true : false)" />
                                                    <input type="hidden" name="isFeatured" value="@p.IsFeatured" />
                                                    <button class="btn btn-sm @(p.IsActive ? "btn-primary" : "btn-outline-secondary")" type="submit">Yayınla</button>
                                                </form>
                                            </td>
                                            <td class="text-center">
                                                <form method="post" asp-page-handler="ToggleStatus">
                                                    <input type="hidden" name="id" value="@p.Id" />
                                                    <input type="hidden" name="isActive" value="@p.IsActive" />
                                                    <input type="hidden" name="isPublished" value="@p.IsActive" />
                                                    <input type="hidden" name="isFeatured" value="@(!p.IsFeatured)" />
                                                    <button class="btn btn-sm @(p.IsFeatured ? "btn-warning" : "btn-outline-secondary")" type="submit">Öne Çıkar</button>
                                                </form>
                                            </td>
                                            <td class="text-end">
                                                <a class="btn btn-sm btn-outline-secondary" asp-page="/Products/Edit" asp-route-id="@p.Id">Düzenle</a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>
</body>
</html>
